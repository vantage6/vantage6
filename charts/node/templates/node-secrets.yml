{{- if not (lookup "v1" "Secret" (.Values.namespace | default .Release.Namespace) (printf "%s-node-secrets" .Release.Name)) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-node-secrets
  namespace: {{ .Values.namespace | default .Release.Namespace }}
data:
  V6_API_KEY: {{ .Values.node.apiKey | b64enc }}
  V6_NODE_NAME: {{ .Values.node.name | b64enc }}
  KEYCLOAK_CLIENT: {{ .Values.node.keycloakClient | b64enc }}
  KEYCLOAK_CLIENT_SECRET: {{ .Values.node.keycloakClientSecret | b64enc }}
  {{- range $db := concat .Values.node.databases.fileBased .Values.node.databases.serviceBased }}
  DATABASE_{{ $db.name | upper }}_URI: {{ $db.uri | b64enc }}
  DATABASE_{{ $db.name | upper }}_TYPE: {{ $db.type | b64enc }}
  {{- if $db.env }}
  {{- range $key, $value := $db.env }}
  DATABASE_{{ $db.name | upper }}_{{ $key | upper }}: {{ $value | b64enc }}
  {{- end }}
  {{- end }}
  {{- end }}
{{- end }}