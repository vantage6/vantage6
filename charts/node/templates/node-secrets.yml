apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-node-secrets
  namespace: {{ .Values.namespace | default .Release.Namespace }}
data:
  {{ range $db := concat .Values.node.databases.fileBased .Values.node.databases.serviceBased }}
  DATABASE_{{ $db.name | upper }}_URI: {{ $db.uri | b64enc }}
  DATABASE_{{ $db.name | upper }}_TYPE: {{ $db.type | b64enc }}
  {{ range $db.env }}
  DATABASE_{{ $db.name | upper }}_{{ .key | upper }}: {{ .value | b64enc }}
  {{ end }}
  {{ end }}