keycloak:
  # Specify the version of the Keycloak Operator to use.
  operatorVersion: "26.0.0"

  # Specify the number of Keycloak instances to deploy.
  instances: 1

  # Whether to use production settings.
  production: true

  # TLS settings - should be enabled for production environments.
  tls:
    enabled: true
    autoGenerated: true

  # Set the username and password for the Keycloak admin. This user is created when
  # Keycloak is initialized and can be used to login to the Keycloak admin UI and
  # manage Keycloak settings.
  auth:
    # For production environments, we recommend storing the admin password in a secret (which MUST
    # contain the 'username' and 'password' keys).
    adminUserSecret: admin-user-secret
    # for development environments, you can set the username and password directly:
    # adminUser: admin
    # adminPassword: admin

  # Development settings - only needed for development environments.
  dev:
    # Whether to forward ports to the host machine. Necessary for sandbox environments.
    forward_ports: true
    # The port on the host machine to expose the Keycloak authentication service to
    # for sandbox environments.
    local_auth_port_to_expose: 30764

  # Ensure that the auth pod has enough resources to run. The default values are enough
  # in most cases, but for a larger environment, you might need to increase the limits.
  resources:
    limits:
      memory: 2Gi
      cpu: 1000m
    requests:
      memory: 1Gi
      cpu: 500m

  # The following configuration initializes the Keycloak realm upon startup. It creates
  # a number of users, roles and secrets that are required for vantage6. It is important
  # to create this realm upon startup to work correctly with the vantage6 hub.
  realmImport:
    enabled: true
    # Keycloak realm name
    realm: vantage6

    # access token lifespan in seconds
    accessTokenLifespan: 300

    # sso session idle timeout in seconds. This is the time before the refresh token
    # expires. With default settings, this value controls the time before the refresh
    # token expires. Note that this should not be set to a value greater than 3600
    # seconds, as the refresh token will then expire before the session timeout.
    ssoSessionIdleTimeout: 1800

    # password policy configuration. If you prefer not to have a password policy,
    # you can set this to an empty string.
    passwordPolicy: "length(8) and upperCase(1) and lowerCase(1) and digits(1) and specialChars(1)"

    # required actions for users. Setting defaultAction to true means that the user will
    # be prompted to perform the action on first login.
    requiredActions:
      # configure OTP for two-factor authentication
      - alias: CONFIGURE_TOTP
        name: Configure OTP
        providerId: CONFIGURE_TOTP
        enabled: true
        defaultAction: true
        priority: 10
      # update password on first login
      - alias: UPDATE_PASSWORD
        name: Update Password
        providerId: UPDATE_PASSWORD
        enabled: true
        defaultAction: true
        priority: 20
      # update email on first login
      - alias: UPDATE_EMAIL
        name: Update Email
        providerId: UPDATE_EMAIL
        enabled: true
        defaultAction: true
        priority: 30
      # verify email on first login - this should only be enable if an SMTP server is
      # configured to send emails.
      - alias: VERIFY_EMAIL
        name: Verify Email
        providerId: VERIFY_EMAIL
        enabled: true
        defaultAction: true
        priority: 40

    # SMTP server configuration. This is used to send emails to users.
    smtpServer:
      host: your-smtp-server-hostname.org
      port: 587                 # usually 587 for STARTTLS, 465 for SSL
      from: your-email-address@your-domain.com
      ssl: false                # true for SSL, false for STARTTLS
      starttls: true            # true for STARTTLS, false for SSL
      # authentication settings - should usually be used, unless you are running tests
      # with a local SMTP server.
      auth: true
      authType: basic           # always use 'basic' for username and password
      user: your-username       # your username (often the same as the email address)
      password: your-password   # your password
      # optional settings for the reply-to address
      replyTo: reply-to-email-address@your-domain.com
      replyToDisplayName: display-name-for-reply-to

    # users to be created in the realm. This initializes the realm with a default
    # admin user. It also initializes the service account for the backend admin
    # client to give it the necessary permissions to manage the realm.
    users:
      # create the vantage6 admin user. The name of this user should also be present
      # in vantage6 HQ and store configuration - it is the user that will be
      # assigned admin permissions on initial startup.
      - username: admin
        enabled: true
        # Setting firstname, last name and email should only be done for development
        # environments. In production, the admin should be prompted to update this on
        # first login.
        email: admin@vantage6.org
        firstName: Admin
        lastName: Admin
        # Initial password - admin user will be prompted to update this on first login
        # in production, provided the right required actions are set.
        credentials:
          - type: password
            value: Admin123!
        # required actions for the admin user. This ensures that the admin user will
        # be prompted to configure 2FA and update their password on first login.
        requiredActions:
          - CONFIGURE_TOTP
          - UPDATE_PASSWORD
      # create the service account for the backend admin client. The
      # serviceAccountClientId should match the value set in the client section below.
      # The vantage6 HQ and store will use this user to create new accounts for users
      # and nodes in keycloak - that is why it gets assigned some realm-management
      # permissions.
      # NOTE: this user should *always* be created - HQ and store rely on it to create
      # new accounts for users and nodes.
      - username: service-account-backend-admin-client
        enabled: true
        serviceAccountClientId: backend-admin-client
        clientRoles:
          realm-management:
            - view-users
            - manage-users
            - view-clients
            - manage-clients
            - create-client

    # clients to be created in the realm. This initializes the realm with a default
    # public client and a backend admin client.
    # NOTE: vantage6 relies on both the public and backend admin client to be created.
    clients:
      # The public client is used by users to authenticate in the browser. Either the
      # UI or the Python client will redirect to this client.
      - clientId: public_client
        publicClient: true
        # redirect URIs are the URIs that keycloak is allowed to redirect to after
        # authentication. This should be set to the UI URL, and to the Keyloak
        # service on port 7681. The latter is needed for authentication from outside
        # the browser - if e.g. the Python client authenticates, it will open a
        # browser window to authenticate that redirects to the Keycloak service on
        # port 7681.
        redirectUris:
          - "http://localhost:7600/*"
          - "http://localhost:7681/*"
        # By setting webOrigins to "+", we allow the same origins as redirectUris.
        webOrigins:
          - "+"
        # The public client is only for users, not for nodes. Therefore, map a
        # constant claim to indicate the that the client is a user. The vantage6 hub
        # relies on this claim to determine if the client is a user or a node.
        protocolMappers:
          - name: vantage6_client_type
            protocol: openid-connect
            protocolMapper: oidc-hardcoded-claim-mapper
            consentRequired: false
            config:
              claim.name: vantage6_client_type
              claim.value: user
              access.token.claim: true
      # create a client that will allow the backend to manage users and clients in
      # keycloak. The secret should be modified to a secure value in production - the
      # rest should be left as is.
      - clientId: backend-admin-client
        publicClient: false
        secret: myadminclientsecret
        serviceAccountsEnabled: true
        standardFlowEnabled: false

database:
  # For production environments, we recommend using an external database
  external: true
  # the hostname of the external database, required if external is set to true.
  hostname: your-database-hostname.org

  # Development settings - needed if external is set to false.
  image:
    repository: postgres
    tag: 13
  username: keycloak
  password: keycloak
  name: keycloak
  volumePath: /mnt/data_auth
  k8sNodeName: docker-desktop
  storageClass: local-storage
